---
title: "Randomization"
---

# Variance randomization

This notebook generates null distributions of trait variance for each community by sampling species at random from the entire Sulawesi species pool. The richness of each community is held constant.

***Warning*** -  These functions take a long time to run. On my 2020 Mac M1 it takes ~10 hours. Just so that you are aware before running them. Also, I use `furrr` to run these in parallel, and set the number of workers to 8, which maxes out my laptop's computing power. Change the number of `workers` in the `plan(multisession, workers = 8)` command. More workers should take less time, but be wary of crashing your computer. 


#### Load Packages and Data  
```{r}
pacman::p_load(here, tidyverse, tidybayes, patchwork, modelr, forcats, picante, furrr)
#supress dplyr messages for summarise()
options(dplyr.summarise.inform = FALSE)

here::i_am('Code/Randomization_Variance.Rmd')

#External Data
edat <- read_csv(here("External_Measurement_Data", "External_Fitted.csv"))
# Cranial Data
cdat <- read_csv(here("Cranial_Data", "Cranial_36axes_Fitted.csv")) %>%
  mutate_if(is.numeric, round, digits=6)
# Dentary Data
ddat <- read_csv(here("Dentary_Data", "Dentary_20axes_Fitted.csv")) %>%
  mutate_if(is.numeric, round, digits=6)

skdat <- ddat  %>% select(!.row) %>% 
  full_join(cdat, by = c(".draw", "Species"))

mdat <- edat  %>% select(!.row) %>% 
  full_join(skdat, by = c(".draw", "Species"))


# Locomotor Data
ldat <-  read_csv(here("Locomotion_Data", "Locomotion_List.csv")) # List of species modes
lvdat <- read_csv(here("Locomotion_Data", "All_Locomotor_Var.csv")) # variances by community


ifit <- read_csv(here("Isotope_Data", "Isotope_Group_Level_Fitted.csv"))

adat <- read_csv(here("All_Traits.csv")) %>% mutate(vBsz = (vdCsize + vcCsize + vHB + vMass) / 4)


sp_ses <- read.csv(here("Phylogenetic_Diversity", "Species_SES.csv")) %>% select(!X)

load(here("Species_Data", "Species_Lists.RData"))
load(here("Species_Data", "Species_Extant.RData"))

#Just as a reminder
n_sp <- tibble(com = c("Ambang", "Bawakaraeng", "Buliohuto", "Dako", "Gandangdewata", "Katopasa", "Latimojong", "Nokilalaki", "Torompupu"),
               num = c(13, 7, 10, 12, 23, 12, 13, 17, 15))

level_order <-  c( "Bawakaraeng", "Buliohuto", "Dako", "Katopasa", "Ambang", "Latimojong", "Torompupu", "Nokilalaki", "Gandangdewata")

```


# Sample Species

Generate 1000 fake communities using the independent swap algorithm.

New sample species using independent swap algorithm from picante
very helpful: https://stackoverflow.com/questions/61740025/dplyr-how-to-collapse-binary-and-mutually-exclusive-columns-into-1
```{r}
sample_com <- function(com) {
dlist <- list()
for (i in 1:100){
  b <- picante::randomizeMatrix(sp_ses, null.model = "independentswap", iterations = 1000) %>% 
    as_tibble() %>% 
    bind_cols(com = c("Ambang", "Bawakaraeng", "Buliohuto", "Dako", "Gandangdewata", "Katopasa", "Latimojong", "Nokilalaki", "Torompupu")) %>% 
    pivot_longer(cols = -com, names_to = 'species') %>%
    filter(as.logical(value)) %>%
    select(-value) %>%
    filter(com == {{com}}) %>% 
    select(-com) %>%
    pull(species)
  dlist[[i]] <- b
  }
dlist
}
```

```{r}
sp_amb <- sample_com("Ambang" )
sp_baw <- sample_com("Bawakaraeng" )
sp_bul <- sample_com("Buliohuto" )
sp_dak <- sample_com("Dako" )
sp_gan <- sample_com("Gandangdewata" )
sp_kat <- sample_com("Katopasa")
sp_lat <- sample_com("Latimojong")
sp_nok <- sample_com("Nokilalaki")
sp_tor <- sample_com("Torompupu")
```

# Randomizations  

## External Randomization

### External Varaince Function

```{r}
get_xvar <- function(sp, data, mountain) {
  data %>%
    filter(Species %in% {{sp}}) %>%
    split(.$.draw) %>%
    map(~ .x[, -c(1:2)]) %>%
    map_dfr(function(df) {
      # Pre-calculate variances to avoid repeating the same calculation
      # surprisingly, this saves a lot of time (25% decrease)
      vHB <- var(df$HB)
      vrHF <- var(df$rHF)
      vrTail <- var(df$rTail)
      vrEar <- var(df$rEar)
      vlMass <- var(df$lMass)
      
      tibble(
        vHB = vHB,
        vHF = vrHF,
        vTail = vrTail,
        vEar = vrEar,
        vMass = vlMass,
        vBsz = (vHB + vlMass) / 2,
        vExt = (vHB + vrHF + vrTail + vrEar + vlMass) / 5
      )
    }) %>%
    sample_n(size = 100) %>%
    mutate(com = mountain)
}

```

External Variance and Summaries
This may take a few hours

`furrr` options for multithreading. 
```{r}
furrr_options(seed = TRUE)
options(future.rng.onMisuse="ignore")
plan(multisession, workers = 16)
```

### Estimate Simulated Communities
```{r}
tictoc::tic()
xamb <- future_map(sp_amb, ~ get_xvar(.x, edat, "Ambang"), chunks = 1000) %>% bind_rows()
xbaw <- future_map(sp_baw, ~ get_xvar(.x, edat, "Bawakaraeng"), chunks = 1000) %>% bind_rows()
xbul <- future_map(sp_bul, ~ get_xvar(.x, edat, "Buliohuto"), chunks = 1000) %>% bind_rows()
xdak <- future_map(sp_dak, ~ get_xvar(.x, edat, "Dako"), chunks = 1000) %>% bind_rows()
xgan <- future_map(sp_gan, ~ get_xvar(.x, edat, "Gandangdewata"), chunks = 1000) %>% bind_rows()
xkat <- future_map(sp_kat, ~ get_xvar(.x, edat, "Katopasa"), chunks = 1000) %>% bind_rows()
xlat <- future_map(sp_lat, ~ get_xvar(.x, edat, "Latimojong"), chunks = 1000) %>% bind_rows()
xnok <- future_map(sp_nok, ~ get_xvar(.x, edat, "Nokilalaki"), chunks = 1000) %>% bind_rows()
xtor <- future_map(sp_tor, ~ get_xvar(.x, edat, "Torompupu"), chunks = 1000) %>% bind_rows()

#this returns the script to a single core, which is normal R behavior.
plan(sequential)

x_rand <- bind_rows(xamb, xbaw, xbul, xdak, xgan, xkat, xlat, xnok, xtor) 
tictoc::toc()
```



### External SES  
```{r}
adat <- 
  x_rand %>% group_by(com) %>% 
  summarise(mHB =   mean(vHB),
            sdHB =    sd(vHB),
            mHF =   mean(vHF),
            sdHF =    sd(vHF),
            mTail = mean(vTail),
            sdTail =  sd(vTail),
            mEar =  mean(vEar),
            sdEar =   sd(vEar),
            mMass = mean(vMass),
            sdMass =  sd(vMass),
            mBsz =  mean(vBsz),
            sdBsz =   sd(vBsz),
            mExt =  mean(vExt),
            sdExt =   sd(vExt)) %>% 
  as.data.frame() %>% 
  right_join(adat, by="com") %>%
  mutate(ses_vHB =  (vHB - mHB) / sdHB,
         ses_vHF = (vHF - mHF) / sdHF,
         ses_vTail = (vTail - mTail) / sdTail,
         ses_vEar = (vEar - mEar) / sdEar,
         ses_vMass = (vMass - mMass) / sdMass,
         ses_vBsz = (vBsz - mBsz) / sdBsz,
         ses_ext = (ext_scaled - mExt) / sdExt) %>% 
  select(!c(mHB,sdHB, mHF, sdHF, mTail, sdTail, mEar, sdEar, mMass, sdMass, mBsz, sdBsz, mExt, sdExt))
```



#### Write

```{r}
adat %>% write_csv(here("All_Traits.csv"))
rm(x_rand, xamb, xbaw, xbul, xdak, xgan, xkat, xlat, xnok, xtor)
```



## Cranial Randomization 

### Cranium Variance Function  
similar to the last one...
```{r}
get_cvar <- function(sp, data, mountain) {
  data %>% 
    filter(Species %in% {{sp}}) %>% 
  split(.$.draw) %>% 
  map(., ~ .x[ ,-c(1:2)]) %>% 
  map(~ .x %>% summarise(across(cPC1:cCsize, ~ var(.x, na.rm = TRUE)))) %>% 
    bind_rows() %>% 
    as_tibble() %>%
      mutate(vc = select(., cPC1:cPC36) %>% rowSums(na.rm = TRUE),
             vcCsize = cCsize) %>% 
      select(vc, vcCsize) %>%
  sample_n(., size = 100) %>% 
    add_column(com = {{mountain}})
}
```


### Estimate Simulated Communities

Warning:: this may take hours depending on furrr & future settings. Using `workers = 16` on an Apple M1 takes about 4 minutes per community.

```{r}
plan(multisession, workers = 16)
tictoc::tic()
camb <- future_map(sp_amb, ~ get_cvar(.x, cdat, "Ambang"), chunks = 1000) %>% bind_rows()
cbaw <- future_map(sp_baw, ~ get_cvar(.x, cdat, "Bawakaraeng"), chunks = 1000) %>% bind_rows()
cbul <- future_map(sp_bul, ~ get_cvar(.x, cdat, "Buliohuto"), chunks = 1000) %>% bind_rows()
cdak <- future_map(sp_dak, ~ get_cvar(.x, cdat, "Dako"), chunks = 1000) %>% bind_rows()
cgan <- future_map(sp_gan, ~ get_cvar(.x, cdat, "Gandangdewata"), chunks = 1000) %>% bind_rows()
ckat <- future_map(sp_kat, ~ get_cvar(.x, cdat, "Katopasa"), chunks = 1000) %>% bind_rows()
clat <- future_map(sp_lat, ~ get_cvar(.x, cdat, "Latimojong"), chunks = 1000) %>% bind_rows()
cnok <- future_map(sp_nok, ~ get_cvar(.x, cdat, "Nokilalaki"), chunks = 1000) %>% bind_rows()
ctor <- future_map(sp_tor, ~ get_cvar(.x, cdat, "Torompupu"), chunks = 1000) %>% bind_rows()

plan(sequential)
     
c_rand <- bind_rows(camb, cbaw, cbul, cdak, cgan, ckat, clat, cnok, ctor) 

rm(camb, cbaw, cbul, cdak, cgan, ckat, clat, cnok, ctor)
tictoc::toc()
```

### Cranium SES
```{r}
adat <- c_rand %>% group_by(com) %>% 
  summarise(vmean = mean(vc),
            vsd = sd(vc),
            vSmean = mean(vcCsize),
            vSsd = sd(vcCsize)) %>% 
  as.data.frame() %>% 
  right_join(adat, by="com") %>%
  mutate(ses_cv_wei =  (cv_wei - vmean) / vsd,
         ses_vcCsize =  (vcCsize - vSmean) / vSsd) %>% 
  select(!c(vmean, vsd, vSmean, vSsd))


```


### Write  

```{r}
adat %>% write_csv(here("All_Traits.csv"))
rm(c_rand)
```

## Dentary Randomization

### Dentary Randomization Function
```{r}
get_dvar <- function(sp, data, mountain) {
  data %>% 
    filter(Species %in% {{sp}}) %>% 
  split(.$.draw) %>% 
  map(., ~ .x[ ,-c(1:2)]) %>% 
  map(~ .x %>% summarise(across(dPC1:dCsize, ~ var(.x, na.rm = TRUE)))) %>% 
    bind_rows() %>% 
    as_tibble() %>%
    mutate(vd = select(., dPC1:dPC20) %>% rowSums(na.rm = TRUE),
             vdCsize = dCsize) %>%
    select(vd, vdCsize) %>%
    sample_n(., size = 100) %>% 
    add_column(com = {{mountain}})
}
```

### Estimate sim. coms  

```{r}
plan(multisession, workers = 16)
tictoc::tic()
damb <- future_map(sp_amb, ~ get_dvar(.x, ddat, "Ambang"), chunks = 1000) %>% bind_rows()
dbaw <- future_map(sp_baw, ~ get_dvar(.x, ddat, "Bawakaraeng"), chunks = 1000) %>% bind_rows()
dbul <- future_map(sp_bul, ~ get_dvar(.x, ddat, "Buliohuto"), chunks = 1000) %>% bind_rows()
ddak <- future_map(sp_dak, ~ get_dvar(.x, ddat, "Dako"), chunks = 1000) %>% bind_rows()
dgan <- future_map(sp_gan, ~ get_dvar(.x, ddat, "Gandangdewata"), chunks = 1000) %>% bind_rows()
dkat <- future_map(sp_kat, ~ get_dvar(.x, ddat, "Katopasa"), chunks = 1000) %>% bind_rows()
dlat <- future_map(sp_lat, ~ get_dvar(.x, ddat, "Latimojong"), chunks = 1000) %>% bind_rows()
dnok <- future_map(sp_nok, ~ get_dvar(.x, ddat, "Nokilalaki"), chunks = 1000) %>% bind_rows()
dtor <- future_map(sp_tor, ~ get_dvar(.x, ddat, "Torompupu"), chunks = 1000) %>% bind_rows()

plan(sequential)

d_rand <- bind_rows(damb, dbaw, dbul, ddak, dgan, dkat, dlat, dnok, dtor) 
rm(damb, dbaw, dbul, ddak, dgan, dkat, dlat, dnok, dtor)
tictoc::toc()
```

### Dentry SES
```{r}
adat <- d_rand %>% group_by(com) %>% 
  summarise(mean_d = mean(vd),
            sd_d = sd(vd),
            mean_sd = mean(vdCsize),
            sd_sd = sd(vdCsize)) %>% 
  as.data.frame() %>% 
  right_join(adat, by="com") %>%
  mutate(ses_dv_wei =  (dv_wei - mean_d) / sd_d,
         ses_vdCsize = (vdCsize - mean_sd) / sd_sd) %>% 
  select(!c(mean_d, sd_d, mean_sd, sd_sd))
```

### write
```{r}
adat %>% write_csv(here("All_Traits.csv"))
rm(d_rand)
```


## Skull Shape Random All Axes

### Skull Variance
Quite a big function

```{r}
get_skvar <- function(sp, data, mountain) {
  data %>% 
    filter(Species %in% {{sp}}) %>% 
    split(.$.draw) %>% 
    map(., ~ .x[ ,-c(1:2)]) %>% 
    map(~ .x %>% summarise(across(c(cPC1:cPC36, dPC1:dPC20), ~ var(.x, na.rm = TRUE)))) %>% 
    bind_rows() %>% 
    as_tibble() %>%
    mutate(vc = select(., cPC1:cPC36) %>% rowSums(na.rm = TRUE),
           vd = select(., dPC1:dPC20) %>% rowSums(na.rm = TRUE),
           vsk = (vd + vc) / 2) %>%  
      select(vsk) %>%
  sample_n(., size = 100) %>% 
    add_column(com = {{mountain}})
}
```


### Estimated Simulatied Communities

56 PC axes, so takes a very long time!
```{r}
tictoc::tic()
plan(multisession, workers = 16)
skamb <- future_map(sp_amb, ~ get_skvar(.x, skdat, "Ambang"), chunks = 1000) %>% bind_rows()
skbaw <- future_map(sp_baw, ~ get_skvar(.x, skdat, "Bawakaraeng"), chunks = 1000) %>% bind_rows()
skbul <- future_map(sp_bul, ~ get_skvar(.x, skdat, "Buliohuto"), chunks = 1000) %>% bind_rows()
skdak <- future_map(sp_dak, ~ get_skvar(.x, skdat, "Dako"), chunks = 1000) %>% bind_rows()
skgan <- future_map(sp_gan, ~ get_skvar(.x, skdat, "Gandangdewata"), chunks = 1000) %>% bind_rows()
skkat <- future_map(sp_kat, ~ get_skvar(.x, skdat, "Katopasa"), chunks = 1000) %>% bind_rows()
sklat <- future_map(sp_lat, ~ get_skvar(.x, skdat, "Latimojong"), chunks = 1000) %>% bind_rows()
sknok <- future_map(sp_nok, ~ get_skvar(.x, skdat, "Nokilalaki"), chunks = 1000) %>% bind_rows()
sktor <- future_map(sp_tor, ~ get_skvar(.x, skdat, "Torompupu"), chunks = 1000) %>% bind_rows()

plan(sequential)

sk_rand <- bind_rows(skamb, skbaw, skbul, skdak, skgan, skkat, sklat, sknok, sktor) 
rm(skamb, skbaw, skbul, skdak, skgan, skkat, sklat, sknok, sktor)
tictoc::toc()
```

### Skull SES  

```{r}

adat <- sk_rand %>% group_by(com) %>% 
  summarise(mean = mean(vsk),
            sd = sd(vsk)) %>% 
  as.data.frame() %>% 
  right_join(adat, by="com") %>%
  mutate(ses_vsk =  (((cv_wei + dv_wei)/2) - mean) / sd) %>% 
  select(!c(mean, sd))

```

### write

```{r}
adat %>% write_csv(here("All_Traits.csv"))
rm(sk_rand)
```

## Morpho Randomization

### Morpho Randomiation Function
vMass + vEar + vHF + vTail + vHB + dv_wei + cv_wei 
I had to change the summarise calculations to include the `na.rm = TRUE` bit so that they would calculate vc and vd with the species are included in ext measurements and not cranial/dent.
```{r}
get_mvar <- function(sp, data, mountain) {
  data %>% 
    filter(Species %in% {{sp}}) %>% 
    split(.$.draw) %>% 
    map(., ~ .x[ ,-c(1:2)]) %>% 
    map(~ .x %>% summarise(across(c(HB:dPC20, cPC1:cPC36), 
                                  ~var(.x, na.rm = TRUE)))) %>%
    bind_rows() %>% 
    as_tibble() %>%
    mutate(vc = select(., cPC1:cPC36) %>% rowSums(na.rm = TRUE),
           vd = select(., dPC1:dPC20) %>% rowSums(na.rm = TRUE)) %>% 
      mutate(vMorpho = (lMass + rEar + rHF + rTail + HB + vc + vd ) / 7) %>% 
      select(vMorpho) %>%
  sample_n(., size = 100) %>% 
    add_column(com = {{mountain}})
}
```


### Estimate Simulated Communities 

```{r}
plan(multisession, workers = 16)
tictoc::tic()
mamb <- future_map(sp_amb, ~ get_mvar(.x, mdat, "Ambang"), chunks = 1000) %>% bind_rows()
mbaw <- future_map(sp_baw, ~ get_mvar(.x, mdat, "Bawakaraeng"), chunks = 1000) %>% bind_rows()
mbul <- future_map(sp_bul, ~ get_mvar(.x, mdat, "Buliohuto"), chunks = 1000) %>% bind_rows()
mdak <- future_map(sp_dak, ~ get_mvar(.x, mdat, "Dako"), chunks = 1000) %>% bind_rows()
mgan <- future_map(sp_gan, ~ get_mvar(.x, mdat, "Gandangdewata"), chunks = 1000) %>% bind_rows()
mkat <- future_map(sp_kat, ~ get_mvar(.x, mdat, "Katopasa"), chunks = 1000) %>% bind_rows()
mlat <- future_map(sp_lat, ~ get_mvar(.x, mdat, "Latimojong"), chunks = 1000) %>% bind_rows()
mnok <- future_map(sp_nok, ~ get_mvar(.x, mdat, "Nokilalaki"), chunks = 1000) %>% bind_rows()
mtor <- future_map(sp_tor, ~ get_mvar(.x, mdat, "Torompupu"), chunks = 1000) %>% bind_rows()

tictoc::toc()

plan(sequential)

m_rand <- bind_rows(mamb, mbaw, mbul, mdak, mgan, mkat, mlat, mnok, mtor) 

rm(mamb, mbaw, mbul, mdak, mgan, mkat, mlat, mnok, mtor)

```



### Morpho SES
```{r}
adat <- m_rand %>% group_by(com) %>% 
  summarise(mean = mean(vMorpho),
            sd = sd(vMorpho)) %>% 
  as.data.frame() %>% 
  right_join(adat, by="com") %>%
  mutate(ses_morpho =  (((cv_wei + dv_wei + vMass + vEar + vHF + vTail + vHB)/ 7) - mean) / sd) %>% 
  select(!c(mean, sd))

```

### write
```{r}

adat %>% write_csv(here("All_Traits.csv"))

rm(camb, cbaw, cbul, cdak, ckat, cgan, clat, cnok, ctor, c_rand)
```

## Isotope Randomization

### Isotope Randomization function

```{r}
get_ivar <- function(sp, data, mountain) {
  data %>% 
    filter(Species %in% {{sp}}) %>% 
  split(.$.draw) %>% 
  map(., ~ .x[ ,-c(1:2)]) %>% 
  map(~ .x %>%
        summarise(
            vC13 = var(sC13), 
            vN15 = var(sN15), 
            vIso = (var(sC13) +  var(sN15)) / 2)) %>%
  bind_rows() %>% 
  as_tibble() %>% 
  sample_n(., size = 100) %>% 
    add_column(com = {{mountain}})
}
```

### Estimate simulated communities  

```{r}
plan(multisession, workers = 16)

iamb <- future_map(sp_amb, ~ get_ivar(.x, ifit, "Ambang"       ), chunks = 1000) %>% bind_rows()
ibaw <- future_map(sp_baw, ~ get_ivar(.x, ifit, "Bawakaraeng"  ), chunks = 1000) %>% bind_rows()
ibul <- future_map(sp_bul, ~ get_ivar(.x, ifit, "Buliohuto"    ), chunks = 1000) %>% bind_rows()
idak <- future_map(sp_dak, ~ get_ivar(.x, ifit, "Dako"         ), chunks = 1000) %>% bind_rows()
igan <- future_map(sp_gan, ~ get_ivar(.x, ifit, "Gandangdewata"), chunks = 1000) %>% bind_rows()
ilat <- future_map(sp_lat, ~ get_ivar(.x, ifit, "Latimojong"   ), chunks = 1000) %>% bind_rows()

plan(sequential)

i_rand <- bind_rows(iamb, ibaw, ibul, idak, igan, ilat) 

df2 <- 
i_rand %>% 
  group_by(com) %>% 
  summarise(mC = mean(vC13),
            sdC = sd(vC13),
            mN = mean(vN15),
            sdN = sd(vN15),
            mI = mean(vIso),
            sdI = sd(vIso)) %>% 
  as.data.frame()
```


### Isotope SES  

```{r}
adat <- 
  i_rand %>% group_by(com) %>% 
  group_by(com) %>% 
  summarise(mC = mean(vC13),
            sdC = sd(vC13),
            mN = mean(vN15),
            sdN = sd(vN15),
            mI = mean(vIso),
            sdI = sd(vIso)) %>% 
  as.data.frame() %>% 
  right_join(adat, by="com") %>%
  mutate(ses_vC13 =  (vC13 - mC) / sdC,
         ses_vN15 =  (vN15 - mN) / sdN,
         ses_vIso =  (iso_var - mI) / sdI) %>% 
  select(!c(mC , sdC, mN , sdN, mI , sdI))
```

### write  

```{r}
adat  %>% write_csv(here("All_Traits.csv"))

```


# Locomotion  

## Locomotion Randomization
```{r}
locdat <- read_csv(here("Locomotion_Data", "Locomotion_List.csv"))
locvar <- read_csv(here("Locomotion_Data", "All_Locomotor_var.csv"))
```

#### Locomotion Randomization Function
```{r}
get_lvar <- function(sp, data, mountain) {
  data %>% 
    filter(Species %in% {{sp}}) %>% 
    select(!Species) %>% 
    summarise(vLoc = var(Loc)) %>%
    as_tibble() %>% 
    add_column(com = {{mountain}})
}
```

### Estimate simulated communities
```{r}
lamb <- map(sp_amb, ~ get_lvar(.x, locdat, "Ambang")) %>% bind_rows()
lbaw <- map(sp_baw, ~ get_lvar(.x, locdat, "Bawakaraeng")) %>% bind_rows()
lbul <- map(sp_bul, ~ get_lvar(.x, locdat, "Buliohuto")) %>% bind_rows()
ldak <- map(sp_dak, ~ get_lvar(.x, locdat, "Dako")) %>% bind_rows()
lgan <- map(sp_gan, ~ get_lvar(.x, locdat, "Gandangdewata")) %>% bind_rows()
lkat <- map(sp_kat, ~ get_lvar(.x, locdat, "Katopasa")) %>% bind_rows()
llat <- map(sp_lat, ~ get_lvar(.x, locdat, "Latimojong")) %>% bind_rows()
lnok <- map(sp_nok, ~ get_lvar(.x, locdat, "Nokilalaki")) %>% bind_rows()
ltor <- map(sp_tor, ~ get_lvar(.x, locdat, "Torompupu")) %>% bind_rows()

l_rand <- bind_rows(lamb, lbaw, lbul, ldak, lgan, lkat, llat, lnok, ltor) 

df5 <- 
l_rand %>% 
  group_by(com) %>% 
  summarise(m = mean(vLoc),
            sd = sd(vLoc)) %>% 
  as.data.frame()
```

### write locomotion data
Simple calculations!
```{r}
df5$var = locvar$vloc
df5$ses_loc= ((df5$var - df5$m) / df5$sd)
locvar$ses_loc = df5$ses_loc
write_csv(locvar, here("Locomotion_Data", "All_Locomotor_var.csv"))
```
