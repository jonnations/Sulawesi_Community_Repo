---
title: "Trait Occupancy Figures"
author: "Jon Nations"
date: "11/22/2021"
output: html_document
---

# Ecospace Occupancy

This script generates Figure 4 to demonstrate differences in ecospace occupancy between clades and traits.


The line widths of the convex hulls are really large in a pdf of this file. Here is info on linewidth in pdfs with ggsave:
https://stackoverflow.com/questions/47519624/how-is-the-line-width-size-defined-in-ggplot2/47521808#47521808

```{r}
pacman::p_load(here, tidyverse, tidybayes, patchwork, modelr, ggstar, pals)
scale2 <- function(x, na.rm = TRUE) (x - mean(x, na.rm = na.rm)) / sd(x, na.rm)
scale3 <- function(x, na.rm = TRUE) (x - mean(x, na.rm = na.rm))

here::i_am('Code/Models_Fitted_Variance.Rmd')

load(here("Species_Data", "Species_Lists.Rdata"))
load(here("Species_Data", "Species_Extant.Rdata"))
level_order <-  c( 'Bawakaraeng', 'Buliohuto','Dako', "Katopasa", "Ambang", "Latimojong", "Torompupu", "Nokilalaki", "Gandangdewata")
level_order2 <-  c( 'Bawakaraeng', 'Buliohuto','Dako',  "Ambang", "Latimojong", "Gandangdewata")

# Clades
echiothrix <- c("Echiothrix_centrosa", "Echiothrix_leucura",  "Gracillimus_radix", "Hyorhinomys_steumpkei", "Melasmothrix_naso",  "Paucidentomys_vermidax", "Sommeromys_macrorhinos", 
"Tateomys_macrocercus", "Tateomys_rhinogradoides", "Waiomys_mamasae")
bunomys <- c("Bunomys_andrewsi", "Bunomys_chrysocomus", "Bunomys_coelestis", "Bunomys_fratrorum", "Bunomys_penitus", "Bunomys_prolatus", "Bunomys_torajae", "Eropeplus_canus", "Lenomys_meyeri", "Paruromys_dominator", "Taeromys_callitrichus", "Taeromys_celebensis", "Taeromys_hamatus", "Taeromys_sp_katopasa", "Taeromys_tarae")
maxomys <- c("Crunomys_celebensis", "Maxomys_dollmani", "Maxomys_hellwaldii", "Maxomys_musschenbroekii", "Maxomys_wattsi")
margaretamys <- c("Margaretamys_elegans", "Margaretamys_parvus")
rattus <- c("Rattus_botanus", "Rattus_facetus", "Rattus_hoffmani", "Rattus_marmosurus", "Rattus_mollicomulus", "Rattus_xanthurus")
haeromys <- c("Haeromys_minahassae")

col_grid <- rgb(235, 235, 235, 100, maxColorValue = 255)
```



# Cranium
Here I am going to ad a new column called "clade" then color the points by it.
## Cranium Data
```{r}
pre.cranium_t <- read_csv(here("Cranial_Data", "Cranial_36axes_Fitted.csv")) %>% select(1:7) %>%
  filter(Species %in% ext_sp) %>% 
  mutate(Clade = case_when(Species %in% unlist(bunomys) ~ "Bunomys (15)",
                           Species %in% unlist(echiothrix) ~ "Echiothrix (10)",
                           Species %in% unlist(maxomys) ~ "Maxomys (5)",
                           Species %in% unlist(margaretamys) ~ "Margaretamys (2)",
                           Species %in% unlist(rattus) ~ "Rattus (6)",
                           TRUE ~ "Haeromys (1)"))


get_cran_means <- function(sp, data, mountain) {
data %>% 
  filter(Species %in% {{sp}}) %>%
  group_by(Species) %>%
    summarise(cPC1 = mean (cPC1),
           cPC2 = mean(cPC2)) %>% 
    add_column(Mountain = {{mountain}})
}

cambt <- get_cran_means(spamb, pre.cranium_t, "Ambang")
cbawt <- get_cran_means(spbaw, pre.cranium_t, "Bawakaraeng") 
cbult <- get_cran_means(spbul, pre.cranium_t, "Buliohuto") 
cdakt <- get_cran_means(spdak, pre.cranium_t, "Dako")
cgant <- get_cran_means(spgan, pre.cranium_t, "Gandangdewata")
ckatt <- get_cran_means(spkat, pre.cranium_t, "Katopasa")
clatt <- get_cran_means(splat, pre.cranium_t, "Latimojong")
cnokt <- get_cran_means(spnok, pre.cranium_t, "Nokilalaki")
ctort <- get_cran_means(sptor, pre.cranium_t, "Torompupu")
com_means <- bind_rows(cambt, cbawt, cbult, cdakt, cgant, ckatt, clatt, cnokt, ctort) 
rm(cambt, cbawt, cbult, cdakt, cgant, ckatt, clatt, cnokt, ctort)

get_cran_means2 <- function(sp, data, mountain) {
data %>% 
  filter(Species %in% {{sp}},
         .draw == (1:500)) %>%
    add_column(Mountain = {{mountain}})
}

cambt <- get_cran_means2(spamb, pre.cranium_t, "Ambang")
cbawt <- get_cran_means2(spbaw, pre.cranium_t, "Bawakaraeng") 
cbult <- get_cran_means2(spbul, pre.cranium_t, "Buliohuto") 
cdakt <- get_cran_means2(spdak, pre.cranium_t, "Dako")
cgant <- get_cran_means2(spgan, pre.cranium_t, "Gandangdewata")
ckatt <- get_cran_means2(spkat, pre.cranium_t, "Katopasa")
clatt <- get_cran_means2(splat, pre.cranium_t, "Latimojong")
cnokt <- get_cran_means2(spnok, pre.cranium_t, "Nokilalaki")
ctort <- get_cran_means2(sptor, pre.cranium_t, "Torompupu")
com_means2 <- bind_rows(cambt, cbawt, cbult, cdakt, cgant, ckatt, clatt, cnokt, ctort) 
rm(cambt, cbawt, cbult, cdakt, cgant, ckatt, clatt, cnokt, ctort)
```

## Cranium Plot  

```{r}
hull_com <- com_means %>% 
  mutate(Mountain = factor(Mountain, level = level_order)) %>% 
  group_by(Mountain) %>% 
  slice(chull(cPC1, cPC2))

hull_com2 <- com_means2 %>% 
  mutate(Mountain = factor(Mountain, level = level_order)) %>% 
  group_by(Mountain, .draw) %>% 
  slice(chull(cPC1, cPC2))

c_plot2 <- pre.cranium_t %>% 
  group_by(Species) %>% 
  slice_sample(n = 100) %>% 
  mutate(mPC1 = mean(cPC1),
         mPC2 = mean(cPC2)) %>% 
ggplot() +
 geom_polygon(data = hull_com, alpha = 0, size = 1, 
              aes(y = cPC2, 
                  x = cPC1, 
                  col = Mountain, 
                  fill = Mountain), 
              show.legend = FALSE) +
   geom_polygon(data = hull_com2, alpha = 0, size = 0.005, 
                aes(y = cPC2, 
                    x = cPC1, 
                    col = Mountain, 
                    fill = Mountain), 
                show.legend = FALSE) +
  scale_color_manual(values=rev(as.vector(cubicyf(20))[c(1, 4, 7, 10, 10, 14, 14, 18, 20)])) +
  ggnewscale::new_scale_fill() +
    geom_star(aes(y = mPC2, x = mPC1,
                starshape = Clade, starstroke = 1), 
              size=4) +
   labs(title="Cranial Shape", x="Cranial PC1", y = " Cranial PC2") +
  theme_classic() +
  guides(color = guide_legend(reverse=T)) +
  annotate("text", 
           x = -0.15, 
           y = 0.1, 
           label = "a", 
           size = 9, 
           face = "bold") +
  theme(legend.position = c(0.14, 0.85),
        plot.title=element_text(size=16.5),
        legend.key.size = unit(1, 'cm'),
        legend.text = element_text(size=14),
        legend.title = element_text(size=16.5),
        panel.grid = element_line(color = col_grid), 
        axis.title.x = element_text(size = 15),
        axis.title.y = element_text(size = 15))

c_plot2

c_plot3 <- read_csv(here("All_Traits.csv")) %>% select(com, ses_vsk) %>% 
  mutate(com = factor(com, level = level_order)) %>% 
  mutate(com = recode(com,
                      'Ambang' = 'Ambang (13)',
                      'Bawakaraeng' = 'Bawakaraeng (7)',
                      'Buliohuto' = 'Buliohuto (10)',
                      'Dako' = 'Dako (12)',
                      'Gandangdewata' = 'Gandang Dewata (23)',
                      'Katopasa' = 'Katopasa (12)',
                      'Latimojong' = 'Latimojong (13)',
                      'Nokilalaki' = 'Nokilalaki (17)',
                      'Torompupu' = 'Torompupu (15)')) %>%
  mutate(sp_com = case_when(com == 'Ambang (13)' ~ 12.9,
                            com == 'Bawakaraeng (7)' ~ 7,
                            com == 'Buliohuto (10)' ~ 10,
                            com == 'Dako (12)' ~ 11.9,
                            com == 'Gandang Dewata (23)' ~ 23,
                            com == 'Katopasa (12)' ~ 12.1,
                            com == 'Latimojong (13)' ~ 13.1,
                            com == 'Nokilalaki (17)' ~ 17,
                            com == 'Torompupu (15)' ~ 15,
                            TRUE ~ NA
                            )) %>% 
  ggplot(aes(x = ses_vsk, y = sp_com, fill = com)) + 
  geom_vline(xintercept = 0, 
             linetype="dotted",  
             size=0.4) +
  stat_halfeye(show.legend = F, ymin = 5) +
  scale_y_continuous(
    breaks = c(7, 10, 12, 13, 15, 17, 23), 
    position = "right",
    limits = (c(7,25))) + 
  labs(y="", x = "Cranial Shape SES") +
  scale_fill_manual(values=rev(as.vector(cubicyf(20))[c(1, 4, 7, 10, 10, 14, 14, 18, 20)])) +
  theme_classic() +
  theme(panel.grid.major.y = element_line( size=.1, color="black" ),
        axis.text.y = element_text(size = 14),
        axis.title.x = element_text(size = 15),
        axis.title.y = element_text(size = 15))
c_plot3

c_plot2 + c_plot3 + plot_layout(widths = c(2, 0.5))
```


It seems that much of the volume is driven by the presence of Echiothrix clade and Haeromys, at least for the cranial measurements. For the other traits, such as tail, nitrogen, and locomotor, this may not be the case, and this could be quite informative. 

# Isotopes
Using the group-level fitted values
## Isotope Data  
```{r}
pre.iso <- read_csv(here("Isotope_Data", "Isotope_Group_Level_Fitted.csv")) %>% 
   filter(Species != "Rattus_exulans") %>% 
  mutate(Clade = case_when(Species %in% unlist(bunomys) ~ "Bunomys (15)",
                           Species %in% unlist(echiothrix) ~ "Echiothrix (10)",
                           Species %in% unlist(maxomys) ~ "Maxomys (5)",
                           Species %in% unlist(margaretamys) ~ "Margaretamys (2)",
                           Species %in% unlist(rattus) ~ "Rattus (6)",
                           TRUE ~ "Haeromys (1)"))

### Functions

get_iso_means <- function(sp, data, mountain) {
data %>% filter(Species %in% {{sp}}) %>% group_by(Species) %>% summarise(sN15 = mean (sN15),
                                             sC13 = mean(sC13)) %>%
    add_column(Mountain = {{mountain}}) %>% 
  slice(chull(sN15, sC13))
}

get_iso_means2 <- function(sp, data, mountain) {
data %>%  filter(Species %in% {{sp}}) %>% filter( .draw == (1:800)) %>% add_column(Mountain = {{mountain}})
}


dambt <- get_iso_means(spamb, pre.iso,"Ambang")
dbawt <- get_iso_means(spbaw, pre.iso, "Bawakaraeng") 
dbult <- get_iso_means(spbul, pre.iso, "Buliohuto") 
ddakt <- get_iso_means(spdak, pre.iso, "Dako")
dgant <- get_iso_means(spgan, pre.iso, "Gandangdewata")
dlatt <- get_iso_means(spkat, pre.iso, "Latimojong")
com_means <- bind_rows(dambt, dbawt, dbult, ddakt, dgant, dlatt) 
rm(dambt, dbawt, dbult, ddakt, dgant, dlatt)

dambt2 <- get_iso_means2(spamb, pre.iso,"Ambang")
dbawt2 <- get_iso_means2(spbaw, pre.iso, "Bawakaraeng") 
dbult2 <- get_iso_means2(spbul, pre.iso, "Buliohuto") 
ddakt2 <- get_iso_means2(spdak, pre.iso, "Dako")
dgant2 <- get_iso_means2(spgan, pre.iso, "Gandangdewata")
dlatt2 <- get_iso_means2(spkat, pre.iso, "Latimojong")
com_means2 <- bind_rows(dambt2, dbawt2, dbult2, ddakt2, dgant2, dlatt2) 
rm(dambt2, dbawt2, dbult2, ddakt2, dgant2, dlatt2)
```

## Isotope Plots
```{r}
hull_com <- com_means  %>% 
  mutate(Mountain = factor(Mountain, level = level_order2))

hull_com2 <- com_means2 %>% 
  mutate(Mountain = factor(Mountain, level = level_order2)) %>% 
  group_by(Mountain, .draw) %>% 
  slice(chull(sN15, sC13))


i_plot2 <- pre.iso %>% 
  group_by(Species) %>% 
  slice_sample(n = 100) %>% 
  mutate(mN15 = mean(sN15),
         mC13 = mean(sC13)) %>% 
  ggplot() + 
  geom_polygon(data = hull_com, alpha = 0, size = 1, 
               aes(y = sC13, x = sN15, col = Mountain, fill = Mountain), 
               show.legend = FALSE) +
   geom_polygon(data = hull_com2, alpha = 0, size = 0.005, 
                aes(y = sC13, x = sN15, col = Mountain, fill = Mountain), 
                show.legend = FALSE) +
  scale_color_manual(values=rev(as.vector(cubicyf(20))[c(1,  10, 10, 14,  18, 20)])) +
  ggnewscale::new_scale_fill() +
    geom_star(aes(y = mC13, x = mN15,
                starshape = Clade,
                starstroke = 1), 
              size=4) +
   labs(title="Isospace",
        x = expression(delta^15~N),
        y = expression(delta^13~C)) +
  xlim(-2.5, 2.3) + 
  ylim(-2.5, 2.3) +
  theme_classic() +
  guides(color = guide_legend(reverse=T)) +
  annotate("text", x = -2.2, y = 2.2, 
           label = "b", size = 9, 
           face = "bold") +
  theme(legend.position = c(0.14, 0.85),
        legend.key.size = unit(1, 'cm'),
        legend.text = element_text(size=14),
        legend.title = element_text(size=16.5),
        plot.title=element_text(size=16.5),
        panel.grid = element_line(color = col_grid),
        axis.title.x = element_text(size = 15),
        axis.title.y = element_text(size = 15))

i_plot2

i_plot3 <- read_csv(here("All_Traits.csv")) %>% 
  select(com, ses_vIso) %>% drop_na() %>% 
  mutate(com = factor(com, level = level_order2)) %>% 
  mutate(com = recode(com,
                      'Ambang' = 'Ambang (13)',
                      'Bawakaraeng' = 'Bawakaraeng (7)',
                      'Buliohuto' = 'Buliohuto (10)',
                      'Dako' = 'Dako (12)',
                      'Gandangdewata' = 'Gandang Dewata (23)',
                      'Latimojong' = 'Latimojong (13)',
                      )) %>%
    mutate(sp_com = case_when(com == 'Ambang (13)' ~ 12.9,
                            com == 'Bawakaraeng (7)' ~ 7,
                            com == 'Buliohuto (10)' ~ 10,
                            com == 'Dako (12)' ~ 12,
                            com == 'Gandang Dewata (23)' ~ 23,
                            com == 'Latimojong (13)' ~ 13.1,
                            TRUE ~ NA
                            )) %>% 
  ggplot(aes(x = ses_vIso, y = sp_com, fill = com)) + 
  geom_vline(xintercept = 0, 
             linetype="dotted",  
             size=0.4) +
  stat_halfeye(show.legend = F, ymin = 4.5) +
  scale_y_continuous(
    breaks = c(7, 10, 12, 13, 15, 17, 23), 
    position = "right",
    limits = (c(7,25))) + 
  scale_fill_manual(values=rev(as.vector(cubicyf(20))[c(1,  10, 10, 14,  18, 20)])) +
  labs(y="Species Richness\n", x = "Isospace SES") +
 theme_classic() +
  theme(panel.grid.major.y = element_line( size=.1, color="black" ),
        axis.text.y = element_text(size = 14),
        axis.title.x = element_text(size = 15),
        axis.title.y = element_text(size = 15))
i_plot3

i_plot2 + i_plot3 + plot_layout(widths = c(2, 0.5))
```
Different pattern with Isotopes. Clades are dispersed across the axes.

# External

## Chose HF and Tail

## External Data
```{r}
pre.ext <- read_csv(here("External_Measurement_Data", "External_Fitted.csv")) %>% 
   filter(Species != "Margaretamys_beccarii") %>% 
  mutate(Clade = case_when(Species %in% unlist(bunomys) ~ "Bunomys (15)",
                           Species %in% unlist(echiothrix) ~ "Echiothrix (10)",
                           Species %in% unlist(maxomys) ~ "Maxomys (5)",
                           Species %in% unlist(margaretamys) ~ "Margaretamys (2)",
                           Species %in% unlist(rattus) ~ "Rattus (6)",
                           TRUE ~ "Haeromys (1)"))

### Functions

get_ext_means <- function(sp, data, mountain) {
data %>% filter(Species %in% {{sp}}) %>% 
    group_by(Species) %>% 
    summarise(mHB = mean(HB),
              mTail = mean(rTail),
              mHF = mean(rHF),
              mEar = mean(rEar),
              mMass = mean(lMass),
              mExt = mean((HB + rTail + rHF + rEar + lMass)/5),
              ) %>%
    add_column(Mountain = {{mountain}})
}

get_ext_means2 <- function(sp, data, mountain) {
data %>%  filter(Species %in% {{sp}}) %>% 
    filter( .draw == (1:500)) %>% 
    add_column(Mountain = {{mountain}})
}

eambt <- get_ext_means(spamb, pre.ext,"Ambang")
ebawt <- get_ext_means(spbaw, pre.ext, "Bawakaraeng") 
ebult <- get_ext_means(spbul, pre.ext, "Buliohuto") 
edakt <- get_ext_means(spdak, pre.ext, "Dako")
egant <- get_ext_means(spgan, pre.ext, "Gandangdewata")
ekatt <- get_ext_means(spkat, pre.ext, "Katopasa")
elatt <- get_ext_means(splat, pre.ext, "Latimojong")
enokt <- get_ext_means(spnok, pre.ext, "Nokilalaki")
etort <- get_ext_means(sptor, pre.ext, "Torompupu")
com_means <- bind_rows(eambt, ebawt, ebult, edakt, egant, ekatt, elatt, enokt, etort) 
rm(eambt, ebawt, ebult, edakt, egant, ekatt, elatt, enokt, etort)

eambt <- get_ext_means2(spamb, pre.ext,"Ambang")
ebawt <- get_ext_means2(spbaw, pre.ext, "Bawakaraeng") 
ebult <- get_ext_means2(spbul, pre.ext, "Buliohuto") 
edakt <- get_ext_means2(spdak, pre.ext, "Dako")
egant <- get_ext_means2(spgan, pre.ext, "Gandangdewata")
ekatt <- get_ext_means2(spkat, pre.ext, "Katopasa")
elatt <- get_ext_means2(splat, pre.ext, "Latimojong")
enokt <- get_ext_means2(spnok, pre.ext, "Nokilalaki")
etort <- get_ext_means2(sptor, pre.ext, "Torompupu")
com_means2 <- bind_rows(eambt, ebawt, ebult, edakt, egant, ekatt, elatt, enokt, etort) 
rm(eambt, ebawt, ebult, edakt, egant, ekatt, elatt, enokt, etort)
```

## External Plot  

```{r}
hull_com <- com_means %>% 
  mutate(Mountain = factor(Mountain, level = level_order)) %>% 
  group_by(Mountain) %>% 
  slice(chull(mHF, mTail))

hull_com2 <- com_means2 %>% 
  mutate(Mountain = factor(Mountain, level = level_order)) %>% 
  group_by(Mountain, .draw) %>% 
  slice(chull(rHF, rTail))


e_plot1 <- pre.ext %>% 
  group_by(Species) %>% 
  mutate(mHF = mean(rHF),
         mTail = mean(rTail)) %>%
  slice_sample(n = 100) %>%
  ggplot() +
 geom_polygon(data = hull_com, alpha = 0, size = 1, 
              aes(y = mTail, 
                  x = mHF, 
                  col = Mountain, 
                  fill = Mountain), 
              show.legend = FALSE) +
   geom_polygon(data = hull_com2, alpha = 0, size = 0.005, 
                aes(y = rTail, 
                    x = rHF, 
                    col = Mountain, 
                    fill = Mountain), 
                show.legend = FALSE) +
  scale_color_manual(values=rev(as.vector(cubicyf(20))[c(1, 4, 7, 10, 10, 14, 14, 18, 20)])) +
  ggnewscale::new_scale_fill() +
    geom_star(aes(y = mTail, x = mHF,
                starshape = Clade,starstroke = 1), size=4) +
   labs(title="Hind Foot & Tail",
        x="Hind Foot Length (mean)", 
        y = "Relative Tail Length (mean)") +
  xlim(-2.5, 2.9) +
  theme_classic() +
  guides(color = guide_legend(reverse=T),
         legend.key = element_rect(colour = NA, fill = NA)) +
  annotate("text", x = -2.2, y = 2.8, 
           label = "c", size = 9, 
           face = "bold") +
  theme(legend.key.size = unit(1, 'cm'),
        plot.title=element_text(size=16.5),
        legend.text = element_text(size=14),
        legend.title = element_text(size=16.5),
        panel.grid = element_line(color = col_grid),
        axis.title.x = element_text(size = 15),
        axis.title.y = element_text(size = 15))

e_plot1

e_plot2 <- read_csv(here("All_Traits.csv")) %>% select(com, ses_vHF) %>% drop_na() %>% 
  mutate(com = factor(com, level = level_order)) %>% 
  mutate(com = recode(com,
                      'Ambang' = 'Ambang (13)',
                      'Bawakaraeng' = 'Bawakaraeng (7)',
                      'Buliohuto' = 'Buliohuto (10)',
                      'Dako' = 'Dako (12)',
                      'Gandangdewata' = 'Gandang Dewata (23)',
                      'Katopasa' = 'Katopasa (12)',
                      'Latimojong' = 'Latimojong (13)',
                      'Nokilalaki' = 'Nokilalaki (17)',
                      'Torompupu' = 'Torompupu (15)')) %>%
  mutate(sp_com = case_when(com == 'Ambang (13)' ~ 12.9,
                            com == 'Bawakaraeng (7)' ~ 7,
                            com == 'Buliohuto (10)' ~ 10,
                            com == 'Dako (12)' ~ 11.9,
                            com == 'Gandang Dewata (23)' ~ 23,
                            com == 'Katopasa (12)' ~ 12.1,
                            com == 'Latimojong (13)' ~ 13.1,
                            com == 'Nokilalaki (17)' ~ 17,
                            com == 'Torompupu (15)' ~ 15,
                            TRUE ~ NA
                            )) %>% 
  ggplot(aes(x = ses_vHF, y = sp_com, fill = com)) + 
  geom_vline(xintercept = 0, 
             linetype="dotted",  
             size=0.4) +
  stat_halfeye(show.legend = F, ymin = 5) +
  scale_y_continuous(
    breaks = c(7, 10, 12, 13, 15, 17, 23), 
    position = "right",
    limits = (c(7,25))) + 
  scale_fill_manual(values=rev(as.vector(cubicyf(20))[c(1, 4, 7, 10, 10, 14, 14, 18, 20)])) +
  labs(y="", x = "Hind Foot SES") +
 theme_classic() + 
  theme(axis.text.y=element_text(size = 14),
        panel.grid.major.y = element_line( size=.1, color="black" ),
        axis.title.x = element_text(size = 15),
        axis.title.y = element_text(size = 15))
e_plot2

e_plot3 <- read_csv(here("All_Traits.csv")) %>% 
  select(com, ses_vTail) %>% drop_na() %>% 
  mutate(com = factor(com, level = level_order)) %>% 
  mutate(com = recode(com,
                      'Ambang' = 'Ambang (13)',
                      'Bawakaraeng' = 'Bawakaraeng (7)',
                      'Buliohuto' = 'Buliohuto (10)',
                      'Dako' = 'Dako (12)',
                      'Gandangdewata' = 'Gandang Dewata (23)',
                      'Katopasa' = 'Katopasa (12)',
                      'Latimojong' = 'Latimojong (13)',
                      'Nokilalaki' = 'Nokilalaki (17)',
                      'Torompupu' = 'Torompupu (15)')) %>%
    mutate(sp_com = case_when(com == 'Ambang (13)' ~ 12.9,
                            com == 'Bawakaraeng (7)' ~ 7,
                            com == 'Buliohuto (10)' ~ 10,
                            com == 'Dako (12)' ~ 11.9,
                            com == 'Gandang Dewata (23)' ~ 23,
                            com == 'Katopasa (12)' ~ 12.1,
                            com == 'Latimojong (13)' ~ 13.1,
                            com == 'Nokilalaki (17)' ~ 17,
                            com == 'Torompupu (15)' ~ 15,
                            TRUE ~ NA
                            )) %>% 
  ggplot(aes(x = ses_vTail, y = sp_com, fill = com)) +
  geom_vline(xintercept = 0, 
             linetype="dotted",  
             size=0.4) +
  stat_halfeye(show.legend = F, ymin = 5) +
  scale_y_continuous(
    breaks = c(7, 10, 12, 13, 15, 17, 23), 
    position = "right",
    limits = (c(7,25))) + 
  scale_fill_manual(values=rev(as.vector(cubicyf(20))[c(1, 4, 7, 10, 10, 14, 14, 18, 20)])) + 
  labs(y="Species Richness\n", x = "Tail SES") +
 theme_classic() +
  theme(panel.grid.major.y = element_line( size=.1, color="black" ),
        axis.text.y = element_text(size = 14),
        axis.title.x = element_text(size = 15),
        axis.title.y = element_text(size = 15))
e_plot3

(e_plot1 + e_plot2 + e_plot3) + plot_layout(widths = c(2, 0.5, 0.5))
```

# Plot Together

```{r}
p1 <-  e_plot1 + e_plot2 + e_plot3 + plot_spacer() + guide_area() + plot_spacer() +
  plot_layout(widths = c(2.05, 0.6, 0.6, 0.65, 0.5, 0.65), 
              guides = "collect")

p2 <-  c_plot2 + c_plot3 +  i_plot2 + i_plot3 + 
  plot_layout(widths = c(2, 0.55, 2, 0.55), guides = "collect") & 
  theme(legend.position = "none")

p2 / p1
ggsave(here("Plots", "Fig4.png"), height = 9, width = 13)
#pdf doesn't render properly
#ggsave(here("Plots", "Fig4.pdf"), height = 9, width = 13)
```

